<div id="content-wrapper" class="contents">
    <div class="row">
        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-12">
                    <div id="content-header" class="clearfix">
                        <div class="pull-left">
                            <ol class="breadcrumb">
                                <li><a [routerLink]="[ '/dashboard/home' ]">Home</a></li>
                                <li><a [routerLink]="[ '/dashboard/contrato' ]">Contrato</a></li>
                                <li class="active"><span>{{ titulo }}</span></li>
                            </ol>
                            <h1> {{ titulo }} Contratos</h1>
                        </div>
                        <div class="text-right">
                            <button [routerLink]="[ '/dashboard/contrato' ]" class="btn btn-light" type="button">
                                Volver
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <header class="main-box-header clearfix">
                    <h2>Usuario</h2>
                </header>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Nombre</label>
                        <input [disabled]="id" type="text" class="form-control" [(ngModel)]="data.usuario.nombre"
                            placeholder="Enter nombre">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Email</label>
                        <input [disabled]="id" type="text" class="form-control" [(ngModel)]="data.usuario.email"
                            placeholder="Enter email">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Numero Celular</label>
                        <input [disabled]="id" type="number" class="form-control" [(ngModel)]="data.usuario.numero"
                            placeholder="Enter Numero">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Cedula</label>
                        <input [disabled]="id" type="text" class="form-control" [(ngModel)]="data.usuario.cedula"
                            placeholder="Enter Cedula">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Dirección</label>
                        <input [disabled]="id" type="text" class="form-control" [(ngModel)]="data.usuario.direccion"
                            placeholder="Enter Dirección">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleFormControlSelect1">Pais</label>
                        <select [disabled]="id" class="form-control" [(ngModel)]="data.usuario.pais">
                            <option *ngFor="let pais of list_pais" [value]="pais.id">{{ pais.pais }}</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <header class="main-box-header clearfix">
                    <h2>Contrato</h2>
                </header>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleFormControlSelect1">Tipo de Contrato</label>
                        <select [disabled]="id" class="form-control" [(ngModel)]="data.detalle.tipo">
                            <option *ngFor="let detalle of list_detalle" [value]="detalle">{{ detalle }}</option>
                        </select>
                    </div>
                    <div class="form-group col-xs-6" *ngIf="id">
                        <label for="exampleFormControlSelect1">Estado de Contrato</label>
                        <select class="form-control" [(ngModel)]="data.contrato.estado">
                            <option *ngFor="let estado of list_estados" [value]="estado">{{ estado }}</option>
                        </select>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">A Cuanto Meses</label>
                        <input [disabled]="id" type="number" class="form-control" [(ngModel)]="data.detalle.meses"
                            placeholder="Enter meses">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Dias Habiles de Corte</label>
                        <input [disabled]="id" type="number" class="form-control"
                            [(ngModel)]="data.detalle.diasHabilesCorte" placeholder="Enter valor Dias Habiles">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="maskedDate">Fecha que Empiezan a generar Facturas</label>
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            <input [disabled]="id" type="date" class="form-control"
                                [(ngModel)]="data.detalle.empiezasPagar">
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Valor sin Iva</label>
                        <input [disabled]="id" type="number" class="form-control"
                            [(ngModel)]="data.contrato.valorApagar" placeholder="Enter valor valor sin iva">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Iva</label>
                        <input [disabled]="id" type="number" class="form-control" [(ngModel)]="data.detalle.valorIva"
                            placeholder="Enter valor Iva">
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleInputEmail1">Valor Total</label>
                        <input [disabled]="id" type="number" class="form-control" [(ngModel)]="data.detalle.valorTotal"
                            placeholder="Enter valor total">
                    </div>
                    <div class="form-group col-xs-12">
                        <label for="exampleInputEmail1">Detalle</label>
                        <textarea class="form-control" id="exampleTextarea" rows="3"
                            [(ngModel)]="data.contrato.detalle"></textarea>
                    </div>
                    <div class="form-group col-xs-12">
                        <br>
                        <div class="text-center">
                            <button (click)="submitContrato()" class="btn btn-success" type="submit" *ngIf="!id">
                                Guardar
                            </button>

                            <button (click)="editarContrato()" class="btn btn-success" type="submit" *ngIf="id">
                                Editar
                            </button>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row" *ngIf="id">
                <div class="row">
                    <header class="main-box-header clearfix">
                        <h2>Evidencias</h2>
                    </header>
                    <div class="main-box-body">
                        <div id="gallery-photos-lightbox">
                            <ul class="clearfix gallery-photos">
                                <li class="col-md-3 col-sm-3 col-xs-6" *ngFor="let file of list_files;let idx=index">
                                    <div *ngIf="file.type !== 'application/pdf'">
                                        <img [src]="file.url" style="height: 188px; width: 219px;" >
                                        <span class="thumb-meta-time">
                                            <a class="table-link mouse" (click)="VerArchivo(file)">
                                                <span class="fa-stack">
                                                    <i class="fa fa-square fa-stack-2x"></i>
                                                    <i class="fa fa-eye fa-stack-1x fa-inverse"></i>
                                                </span>
                                            </a>
                                            <a class="table-link mouse dangerA" (click)="DeleteArchivo(file, idx)">
                                                <span class="fa-stack">
                                                    <i class="fa fa-square fa-stack-2x"></i>
                                                    <i class="fa fa-trash fa-stack-1x fa-inverse"></i>
                                                </span>
                                            </a>
                                        </span>
                                        <!--<span class="thumb-meta-time"><i class="fa fa-clock-o"></i> 23 minutes ago</span>-->
                                    </div>
                                    <div *ngIf="file.type === 'application/pdf'">
                                        <iframe style="width: 100%; height: 191px;" [src]="file.url" frameborder="0"
                                        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                        <span class="thumb-meta-time">
                                            <a class="table-link mouse" (click)="VerArchivo(file)">
                                                <span class="fa-stack">
                                                    <i class="fa fa-square fa-stack-2x"></i>
                                                    <i class="fa fa-eye fa-stack-1x fa-inverse"></i>
                                                </span>
                                            </a>
                                            <a class="table-link mouse dangerA" (click)="DeleteArchivo(file, idx)">
                                                <span class="fa-stack">
                                                    <i class="fa fa-square fa-stack-2x"></i>
                                                    <i class="fa fa-trash fa-stack-1x fa-inverse"></i>
                                                </span>
                                            </a>
                                        </span>
                                        <!--<span class="thumb-meta-time"><i class="fa fa-clock-o"></i> 23 minutes ago</span>-->
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <br>
                    <ngx-dropzone (change)="onSelect($event)">
                        <ngx-dropzone-label>Abrir archivos</ngx-dropzone-label>
                        <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview" *ngFor="let f of files"
                            [file]="f" [removable]="true" (removed)="onRemove(f)">
                            <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
                        </ngx-dropzone-image-preview>
                    </ngx-dropzone>
                </div>
                <div class="form-group col-xs-12">
                    <br>
                    <div class="text-center">
                        <button (click)="subirArchivos()" class="btn btn-success" type="submit">
                            Subir Archivos
                        </button>
                    </div>
                </div>
            </div>
            <div class="row" *ngIf="id">
                <header class="main-box-header clearfix">
                    <h2>Facturas</h2>
                </header>
                <div class="main-box-body clearfix">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th><span>Acciones</span></th>
                                    <th><span>Numero Factura</span></th>
                                    <th><span>Contrato Codigo</span></th>
                                    <th><span>Factura Generada</span></th>
                                    <th><span>Facturas Atrasadas</span></th>
                                    <th><span>Precio Total</span></th>
                                    <th><span>Estado</span></th>
                                    <th><span>Fecha Pagada</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let row of list_facturas">
                                    <td style="width: 15%;">
                                        <a (click)="verFactura(row, false)" class="table-link mouse">
                                            <span class="fa-stack">
                                                <i class="fa fa-square fa-stack-2x"></i>
                                                <i class="fa fa-eye fa-stack-1x fa-inverse"></i>
                                            </span>
                                        </a>
                                        <a (click)="verFactura(row, 'pdf')" class="table-link warning mouse">
                                            <span class="fa-stack">
                                                <i class="fa fa-square fa-stack-2x"></i>
                                                <i class="fa fa-file-pdf-o fa-stack-1x fa-inverse"></i>
                                            </span>
                                        </a>
                                    </td>
                                    <td>{{ row['numeroFactura'] }}</td>
                                    <td>{{ row['idContrato']?.codigo }}</td>
                                    <td>{{ row['fechaGeneradaFormat'] }}</td>
                                    <td>{{ row['facturasAtrasadas'] }}</td>
                                    <td>{{ (row['valorTotal']).toLocaleString('de-DE', { style: 'currency', currency: 'COP' }) }}
                                    </td>
                                    <td>{{ row['estado'] }}</td>
                                    <td>{{ row['fechaPagada'] }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>